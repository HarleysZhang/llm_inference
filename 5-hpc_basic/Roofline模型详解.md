- [1. 性能模型介绍](#1-性能模型介绍)
- [3. Roofline 性能模型](#3-roofline-性能模型)

> 作者设计了一个直观的**性能模型**，帮助程序员和硬件架构师找到提升浮点计算并行软件和硬件性能的方法。

## 1. 性能模型介绍

多核处理器设计的兴起，同时针对多核设计还没有统一的设计原则，这使得程序员编写高性能程序面临更加复杂的挑战，因此**提出一个易于理解并能提供性能优化建议的性能模型**显得尤为重要。

一个性能模型不必完美，关键是能提供启发性。例如，缓存的 3Cs 模型就是一个典型案例[19]。尽管它没有考虑诸如块大小、分配策略、替换策略等重要因素，且存在一些特异情况，例如同一大小的缓存可能在不同设计下会产生容量或冲突问题，它依然在过去20年里得到了广泛应用，因为它为程序行为提供了宝贵的洞见，帮助了程序员、编译器编写者和架构师改进他们的设计。本文提出了一个类似的性能模型，并通过四个多核系统上的四个关键浮点运算模块进行验证。
> 3Cs 模型是指：Capacity Miss（容量缺失）：缓存大小不足导致的数据缺失；Conflict Miss（冲突缺失）：由于缓存冲突导致的缺失；Compulsory Miss（初始缺失）：首次访问导致的缺失

作者认为与其精确预测多处理器系统中的程序表现，不如考虑**性能界限和瓶颈分析**，这种方法给出了影响性能的关键因素并突出了瓶颈的量化分析[20]。最著名的例子就是**阿姆达尔定律**[3]，其明确指出，**并行计算机的性能提升受限于并行程序中的串行部分**。近年来，这一定律已被应用于异构多核计算机[4][18]。

## 3. Roofline 性能模型

本文认为，过去以及可以预见的未来，**芯片外内存带宽 off-chip memory bandwidth**（CPU 内存或者 GPU 显存）往往是制约系统性能的关键因素[23]。因此，我们需要一个模型，将处理器性能与芯片外内存传输（CPU 和 DRAM 数据交换）联系起来。
> 作者这个预测太准了，深度学习时代以来，无论是 CNN 亦或者 Transformer 架构模型，在优化模型速度上，考虑芯片内存带宽并减少模型内存访问代价是一个非常广泛的方法。

为此，本文引入了“操作强度”（operational intensity）这个概念，表示每字节 DRAM 数据传输（`traffic`）所对应的操作次数，这里的字节数是指那些经过缓存层过滤后进入主内存 DRAM 的字节，即我们关注的是**缓存与内存之间的数据传输**，而不是处理器与缓存之间的数据传输（`traffic`）。因此，操作强度反映了在特定计算机上某个计算核所需的 DRAM 带宽。
> 操作强度定义其他表达：每字节内存数据传输所对应的操作次数，即每字节 `flops`。

本文之所以使用“操作强度”来取代“算术强度”(`arithmetic intensity`)[16]或“机器平衡”(`machine balance`)[8][11]，有两个原因：首先，算术强度和机器平衡通常衡量处理器与缓存之间的数据传输（`traffic`），而我们则关注缓存与 DRAM 之间的 `traffic`。这个细微的区别让我们能够在模型中纳入内存优化技术。其次，我们希望该模型不仅适用于算术运算的核（详见第7节），因此我们需要一个比“算术”更为广泛的术语。

本文提出的模型将**浮点运算性能、操作强度和内存性能整合在一个二维图中**。浮点运算的峰值性能可以通过硬件规格或微基准测试得出。由于我们所考察的计算核的工作集无法完全放入片上缓存，因此内存性能的峰值由缓存之后的内存系统决定。虽然也可以通过 STREAM 基准测试[22]来衡量内存性能，但作者在本研究中还是编写了一系列逐步优化的微基准测试，以确定可持续的 DRAM 带宽。这些测试包括了所有能够优化内存性能的技术，比如预取和数据对齐。（附录 A.1 中详细说明了如何测量处理器性能、内存性能和操作强度的详细信息。）